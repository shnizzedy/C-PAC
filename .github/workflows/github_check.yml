name: Set GitHub check

on:
  workflow_call:
    inputs:
      name:
        required: true
        type: string
      sha:
        required: true
        type: string
      status:
        required: true
        type: string

jobs:
  set-GitHub-check:
    name: Set status
    runs-on: ubuntu-latest
    steps:
      - name: Build and test C-PAC
        run: |
          if [[ ${{ inputs.status }} == 'in_progress' ]]
          then
            echo "$ACTIONS_WORKFLOW_TOKEN" | gh auth login --with-token && gh api repos/{owner}/{repo}/check-runs {"name":"${{ inputs.name }}","head_sha":"${{ inputs.sha }}","details_url":"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID","status":"${{ inputs.status }}"}
          else
            echo "$ACTIONS_WORKFLOW_TOKEN" | gh auth login --with-token && gh api repos/{owner}/{repo}/check-runs {"name":"${{ inputs.name }}","head_sha":"${{ inputs.sha }}","details_url":"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID","conclusion":"${{ inputs.status }}"}
        env:
          ACTIONS_WORKFLOW_TOKEN: ${{ secrets.ACTIONS_WORKFLOW_TOKEN }}